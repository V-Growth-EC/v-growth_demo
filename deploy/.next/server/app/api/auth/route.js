(()=>{var e={};e.id=188,e.ids=[188],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4580:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>c,serverHooks:()=>l,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{DELETE:()=>p,POST:()=>u});var a=r(6559),o=r(8088),n=r(7719),i=r(2190);async function u(e){try{let{authCode:t}=await e.json(),r=process.env.EDU_CART_API_KEY;if(!t||!r)return i.NextResponse.json({error:"缺少認證碼或 API 金鑰"},{status:400});let s=await fetch("https://api.edu-cart.jp/customers/auth",{method:"POST",headers:{"x-api-key":r,"Content-Type":"application/json"},body:JSON.stringify({auth_code:t})}),a=await s.json();if(console.log("data:",a,s),!s.ok||!a||"number"!=typeof a.customer_id||-1===a.customer_id)return i.NextResponse.json({error:"認證失敗，請確認認證碼或權限",detail:a},{status:401});{let e=i.NextResponse.json(a,{status:200});return e.cookies.set("auth_token","authenticated",{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"}),e.cookies.set("customer_id",String(a.customer_id),{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"}),e}}catch(e){return i.NextResponse.json({error:"驗證失敗",detail:e.message},{status:500})}}async function p(){try{let e=i.NextResponse.json({success:!0});return e.cookies.set("auth_token","",{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:0,path:"/",expires:new Date(0)}),e.cookies.set("customer_id","",{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:0,path:"/",expires:new Date(0)}),e}catch(e){return i.NextResponse.json({error:"ログアウト処理中にエラーが発生しました。"},{status:500})}}r(4999);let c=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/auth/route",pathname:"/api/auth",filename:"route",bundlePath:"app/api/auth/route"},resolvedPagePath:"/Users/apple/demielxenu-next/src/app/api/auth/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:x,serverHooks:l}=c;function h(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:x})}},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6487:()=>{},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580,999],()=>r(4580));module.exports=s})();